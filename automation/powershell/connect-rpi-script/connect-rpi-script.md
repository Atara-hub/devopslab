# Скрипт Connect-RPi для PowerShell

## Описание
PowerShell скрипт для автоматического обнаружения Raspberry Pi (или любого устройства) в локальной сети по MAC-адресу и подключения через SSH. Скрипт включает быстрое сканирование сети для поиска устройств, отсутствующих в таблице ARP.

## Возможности
- Обнаружение по MAC-адресу: Поиск устройств по их MAC-адресу в локальной сети
- Быстрое сканирование сети: Параллельное сканирование с использованием PowerShell jobs (в 10-20 раз быстрее последовательного пинга)
- Интерактивный выбор устройств: Преднастроенный список устройств с легким переключением
- Гибкая настройка: Простое изменение настроек в начале скрипта
- Обработка ошибок: Комплексная обработка ошибок и логирование
- Управление таблицей ARP: Автоматическое обновление таблицы ARP во время сканирования

## Установка
1. Сохраните скрипт как Connect-RPi.ps1
2. Убедитесь, что политика выполнения PowerShell разрешает запуск скриптов:
   Set-ExecutionPolicy RemoteSigned -Scope CurrentUser
3. Убедитесь, что установлен клиент OpenSSH в Windows

## Настройка
Отредактируйте секцию настроек в начале скрипта:

# Основной MAC-адрес для поиска (по умолчанию)
$DefaultMacAddress = "ваш-mac-адрес-здесь"

# Альтернативные MAC-адреса (для разных устройств)
$AlternativeDevices = @{
    "Raspberry_Pi_1" = "ваш-mac-адрес-здесь"
    "Raspberry_Pi_2" = "dc-a6-32-00-00-00"  # Пример для RPi 4
    "Raspberry_Pi_3" = "e4-5f-01-00-00-00"  # Пример для RPi 3B+
    "My_Laptop"      = "00-11-22-33-44-55"  # Пример для ноутбука
    "Work_PC"        = "aa-bb-cc-dd-ee-ff"  # Пример для рабочего ПК
}

# Параметры подключения
$DefaultUsername = "TopUserServer"
$DefaultGateway = "192.168.1.1"
$NetworkRange = "192.168.1"  # Будет сканировать 192.168.1.1-254

## Использование
### Базовое использование
.\Connect-RPi.ps1

### С пользовательскими параметрами
.\Connect-RPi.ps1 -MacAddress "ваш-mac-адрес-здесь" -Username "TopUserServer" -Gateway "192.168.1.1"

### Интерактивное меню
При запуске без параметров скрипт покажет:

1. Main device (MAC: ваш-mac-адрес-здесь)
2. Raspberry_Pi_1 (MAC: ваш-mac-адрес-здесь)
3. Raspberry_Pi_2 (MAC: dc-a6-32-00-00-00)
4. Raspberry_Pi_3 (MAC: e4-5f-01-00-00-00)
5. My_Laptop (MAC: 00-11-22-33-44-55)
6. Work_PC (MAC: aa-bb-cc-dd-ee-ff)
0. Enter MAC address manually

Select device to search (0-6): 

## Как это работает
1. Первоначальная проверка ARP: Проверяет, есть ли устройство в таблице ARP
2. Пинг шлюза: Пингует шлюз для обновления таблицы ARP
3. Обнаружение устройства: Ищет указанный MAC-адрес
4. Сканирование сети: Если не найдено, предлагает просканировать сеть (192.168.1.1-254)
5. Параллельное сканирование: Использует PowerShell jobs для быстрого параллельного пинга
6. SSH подключение: Автоматически подключается через SSH при обнаружении устройства

## Производительность
- Последовательное сканирование: ~5-10 минут (254 адреса)
- Параллельное сканирование: ~10-30 секунд (те же 254 адреса)
- Использование памяти: Оптимизированная очистка jobs для предотвращения утечек памяти

## Решение проблем
### Частые проблемы
1. Устройство не найдено в таблице ARP: 
   - Запустите сканирование сети для заполнения таблицы ARP
   - Убедитесь, что устройство включено и подключено

2. Ошибка SSH подключения:
   - Проверьте, запущена ли служба SSH на целевом устройстве
   - Проверьте настройки брандмауэра
   - Подтвердите имя пользователя и пароль

3. Блокировка выполнения скрипта:
   Set-ExecutionPolicy RemoteSigned -Scope CurrentUser

## Требования
- Windows PowerShell 5.1 или PowerShell 7+
- Клиент OpenSSH (встроенный в Windows 10/11 или установка через Дополнительные компоненты)
- Доступ к сети для целевых устройств
- Сервер SSH запущен на целевом устройстве

## Примечания
- Скрипт автоматически очищает PowerShell jobs для предотвращения утечек памяти
- Сканирование сети имеет таймаут 30 секунд для оптимальной производительности
- MAC-адреса должны быть в формате: xx-xx-xx-xx-xx-xx
- Поддерживает как проводные, так и беспроводные сетевые подключения

## Поддержка
При возникновении проблем проверьте:
1. Устройство включено и подключено к сети
2. Правильно настроен MAC-адрес
3. Служба SSH запущена на целевом устройстве
4. Брандмауэр Windows разрешает SSH подключения

## Лицензия
Этот скрипт предоставляется как есть, без гарантий. Можете свободно модифицировать и распространять в соответствии со своими потребностями.
